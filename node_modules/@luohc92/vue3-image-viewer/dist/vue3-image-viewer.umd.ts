(function(n,u){typeof exports=="object"&&typeof module<"u"?module.exports=u(require("vue")):typeof define=="function"&&define.amd?define(["vue"],u):(n=typeof globalThis<"u"?globalThis:n||self,n["vue3-image-viewer"]=u(n.Vue))})(this,function(n){"use strict";const u=typeof window>"u",p=function(){return u?function(e,o,i){e&&o&&i&&e.attachEvent("on"+o,i)}:function(e,o,i){e&&o&&i&&e.addEventListener(o,i,!1)}}(),b=function(){return u?function(e,o,i){e&&o&&e.detachEvent("on"+o,i)}:function(e,o,i){e&&o&&e.removeEventListener(o,i,!1)}}(),S=function(){return!u&&!!window.navigator.userAgent.match(/firefox/i)};function C(e){let o=!1;return function(...i){o||(o=!0,window.requestAnimationFrame(f=>{e.apply(this,i),o=!1}))}}const Z="",D=n.defineComponent({name:"ImageViewer",props:{curIndex:{type:Number,default:0},images:{type:Array,default:[]},showDownload:{type:Boolean,default:!1},showThumbnail:{type:Boolean,default:!1},handlePosition:{type:String,default:"bottom"},onClose:{type:Function,default:()=>{}},onDownload:{type:Function,default:e=>{}},zIndex:{type:Number,default:2e3},maskBgColor:{type:String,default:"rgba(0,0,0,0.5)"}},emits:["destroy"],setup(e,{emit:o}){const i={CONTAIN:{name:"contain",icon:"icon-full-screen"},ORIGINAL:{name:"original",icon:"icon-c-scale-to-original"}},f=S()?"DOMMouseScroll":"mousewheel",t=n.reactive({mode:i.CONTAIN,visible:!1,curIndex:0,isMouseEnterThumbnail:!1,thumbnailTransitionShow:!1,transform:{scale:1,deg:0,rotateY:0,offsetX:0,offsetY:0,enableTransition:!1},dragHandler:()=>{},keyDownHandler:s=>{},mouseWheelHandler:()=>{}}),h=n.ref(),a=n.computed(()=>e.handlePosition=="bottom"?{top:"10px",bottom:"auto"}:{bottom:"10px",top:"auto"}),w=n.computed(()=>e.handlePosition=="bottom"?{bottom:e.showThumbnail&&e.images&&e.images.length>1?"100px":"30px",top:"auto"}:{top:"30px",bottom:"auto"}),N=n.computed(()=>{const{scale:s,deg:l,rotateY:c,offsetX:d,offsetY:r,enableTransition:m}=t.transform,E={transform:`scale(${s}) rotate(${l}deg) rotateY(${c}deg)`,transition:m?"transform .3s":"","margin-left":`${d}px`,"margin-top":`${r}px`,maxWidth:"",maxHeight:""};return t.mode.name===i.CONTAIN.name&&(E.maxWidth=E.maxHeight="100%"),E}),v=n.computed(()=>t.curIndex===0),P=n.computed(()=>t.curIndex===e.images.length-1),j=s=>{t.isMouseEnterThumbnail=s},k=s=>{if(!e.showThumbnail)return;t.curIndex=s;let l=h.value;if(!l)return;let c=l.clientWidth,d=l.scrollLeft,r=l.children[s].offsetLeft;c-r<160?c-r<0&&d===0?l.scrollLeft=r-c+160:l.scrollLeft=d+80:r-d<80&&(l.scrollLeft=r-120)},x=s=>{if(s.button!==0)return;const{offsetX:l,offsetY:c}=t.transform,d=s.pageX,r=s.pageY;t.dragHandler=C(m=>{t.transform.offsetX=l+m.pageX-d,t.transform.offsetY=c+m.pageY-r}),p(document,"mousemove",t.dragHandler),p(document,"mouseup",()=>{b(document,"mousemove",t.dragHandler)}),s.preventDefault()},I=()=>{if(v.value)return;const s=e.images.length;t.curIndex=(t.curIndex-1+s)%s,k(t.curIndex)},T=()=>{if(P.value)return;const s=e.images.length;t.curIndex=(t.curIndex+1)%s,k(t.curIndex)},G=()=>{t.keyDownHandler=s=>{switch(s.preventDefault(),s.keyCode){case 17:g("mirror");break;case 18:g("clockwise");break;case 27:y();break;case 32:V();break;case 37:I();break;case 38:g("zoomIn");break;case 39:T();break;case 40:g("zoomOut");break}},t.mouseWheelHandler=C(s=>{const l=s.wheelDelta?s.wheelDelta:-s.detail;if(t.isMouseEnterThumbnail){let c=-1,d=1,r=0;r=l>0?c*50:d*50,h.value&&(h.value.scrollLeft=h.value.scrollLeft+r)}else l>0?g("zoomIn",{zoomRate:.015,enableTransition:!1}):g("zoomOut",{zoomRate:.015,enableTransition:!1})}),p(document,"keydown",t.keyDownHandler),p(document,f,t.mouseWheelHandler)},U=()=>{b(document,"keydown",t.keyDownHandler),b(document,f,t.mouseWheelHandler),t.keyDownHandler=s=>{},t.mouseWheelHandler=()=>{}},g=(s,l={})=>{const{zoomRate:c,rotateDeg:d,enableTransition:r}={zoomRate:.2,rotateDeg:90,enableTransition:!0,...l},{transform:m}=t;switch(s){case"zoomOut":m.scale>.2&&(m.scale=parseFloat((m.scale-c).toFixed(3)));break;case"zoomIn":m.scale=parseFloat((m.scale+c).toFixed(3));break;case"clockwise":m.deg+=d;break;case"anticlockwise":m.deg-=d;break;case"mirror":m.rotateY+=180;break}m.enableTransition=r},J=()=>{t.transform={scale:1,deg:0,rotateY:0,offsetX:0,offsetY:0,enableTransition:!1}},V=()=>{const s=Object.keys(i),l=Object.values(i),d=(l.findIndex(r=>r.name==t.mode.name)+1)%s.length;t.mode=l[d],J()},K=()=>{e.onDownload(e.images[t.curIndex])},Q=()=>{y()},y=()=>{o("destroy"),e.onClose(),U(),t.visible=!1,t.thumbnailTransitionShow=!1};return n.onMounted(()=>{t.curIndex=e.curIndex,G(),t.visible=!0,n.nextTick(()=>{t.thumbnailTransitionShow=!0})}),{...n.toRefs(t),close:y,handleTapClose:Q,pre:I,next:T,thumbnailRef:h,imgStyle:N,handleMouseDown:x,sequenceStyle:a,actionStyle:w,handleActions:g,download:K,toggleMode:V,change:k,mouseEnterThumbnail:j}}}),ee="",z=(e,o)=>{const i=e.__vccOpts||e;for(const[f,t]of o)i[f]=t;return i},$=[n.createElementVNode("i",{class:"iconfont icon-close"},null,-1)],B=[n.createElementVNode("i",{class:"iconfont icon-arrow-left"},null,-1)],_=[n.createElementVNode("i",{class:"iconfont icon-arrow-right"},null,-1)],H={class:"tmd-image-viewer__image"},M=["src"],A={class:"tmd-image-viewer_actions__inner"},F=n.createElementVNode("span",{class:"tmd-image-viewer__actions__divider"},null,-1),L=n.createElementVNode("span",{class:"tmd-image-viewer__actions__divider"},null,-1),O=n.createElementVNode("span",{class:"tmd-image-viewer__actions__divider"},null,-1),Y=["onClick"],R=["src"];function W(e,o,i,f,t,h){return n.openBlock(),n.createBlock(n.Transition,{name:"viewer-fade"},{default:n.withCtx(()=>[n.withDirectives(n.createElementVNode("div",{tabindex:"-1",class:"tmd-image-viewer__wrapper",style:n.normalizeStyle(`z-index:${e.zIndex}`)},[n.createElementVNode("div",{class:"tmd-image-viewer__mask",style:n.normalizeStyle(`background-color:${e.maskBgColor};`),onClick:o[0]||(o[0]=(...a)=>e.handleTapClose&&e.handleTapClose(...a))},null,4),n.createElementVNode("span",{class:"tmd-image-viewer__btn tmd-image-viewer__close",onClick:o[1]||(o[1]=(...a)=>e.close&&e.close(...a))},$),e.images&&e.images.length>1?(n.openBlock(),n.createElementBlock("span",{key:0,class:"tmd-image-viewer__btn tmd-image-viewer__pre",onClick:o[2]||(o[2]=(...a)=>e.pre&&e.pre(...a))},B)):n.createCommentVNode("",!0),e.images&&e.images.length>1?(n.openBlock(),n.createElementBlock("span",{key:1,class:"tmd-image-viewer__btn tmd-image-viewer__next",onClick:o[3]||(o[3]=(...a)=>e.next&&e.next(...a))},_)):n.createCommentVNode("",!0),n.createElementVNode("div",H,[n.withDirectives(n.createElementVNode("img",{src:e.images[e.curIndex],style:n.normalizeStyle(e.imgStyle),onMousedown:o[4]||(o[4]=(...a)=>e.handleMouseDown&&e.handleMouseDown(...a))},null,44,M),[[n.vShow,e.images&&e.images.length>0&&e.images[e.curIndex]]])]),n.createElementVNode("div",{class:"tmd-image-viewer__actions",style:n.normalizeStyle(e.actionStyle)},[n.createElementVNode("div",A,[n.createElementVNode("span",{class:"iconfont icon-zoom-out",onClick:o[5]||(o[5]=a=>e.handleActions("zoomOut"))}),n.createElementVNode("span",{class:"iconfont icon-zoom-in",onClick:o[6]||(o[6]=a=>e.handleActions("zoomIn"))}),F,n.createElementVNode("span",{class:"iconfont icon-refresh-left",onClick:o[7]||(o[7]=a=>e.handleActions("anticlockwise"))}),n.createElementVNode("span",{class:"iconfont icon-refresh-right",onClick:o[8]||(o[8]=a=>e.handleActions("clockwise"))}),n.createElementVNode("span",{class:"iconfont icon-mirror",onClick:o[9]||(o[9]=a=>e.handleActions("mirror"))}),L,n.createElementVNode("span",{class:n.normalizeClass(["iconfont",e.mode.icon]),onClick:o[10]||(o[10]=(...a)=>e.toggleMode&&e.toggleMode(...a))},null,2),e.showDownload?(n.openBlock(),n.createElementBlock(n.Fragment,{key:0},[O,n.createElementVNode("span",{class:"iconfont icon-download",onClick:o[11]||(o[11]=(...a)=>e.download&&e.download(...a))})],64)):n.createCommentVNode("",!0)])],4),n.createVNode(n.Transition,{name:"thumbnail-fade",onAfterEnter:o[14]||(o[14]=a=>e.change(e.curIndex))},{default:n.withCtx(()=>[n.withDirectives(n.createElementVNode("div",{class:"tmd-image-viewer__thumbnail",ref:"thumbnailRef",onMouseenter:o[12]||(o[12]=a=>e.mouseEnterThumbnail(!0)),onMouseleave:o[13]||(o[13]=a=>e.mouseEnterThumbnail(!1))},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(e.images,(a,w)=>(n.openBlock(),n.createElementBlock("div",{class:n.normalizeClass(["tmd-image-viewer__thumbnail__inner",{current:e.curIndex===w}]),key:a+"_thumbnail_"+w,onClick:N=>e.change(w)},[n.createElementVNode("img",{src:a},null,8,R)],10,Y))),128))],544),[[n.vShow,e.thumbnailTransitionShow&&e.showThumbnail&&e.images&&e.images.length>1]])]),_:1}),n.withDirectives(n.createElementVNode("span",{class:"tmd-image-viewer__sequence",style:n.normalizeStyle(e.sequenceStyle)},n.toDisplayString(e.curIndex+1)+" / "+n.toDisplayString(e.images.length),5),[[n.vShow,!e.showThumbnail]])],4),[[n.vShow,e.visible]])]),_:1})}const X=z(D,[["render",W]]),q={curIndex:0,images:[],showDownload:!1,showThumbnail:!1,handlePosition:"bottom",onClose:Function,onDownload:Function,zIndex:2e3,maskBgColor:"rgba(0,0,0,0.5)"};return e=>{const o=document.createElement("div");o.className="tmd-image-viewer-container";const i={...q,...e},f=n.createVNode(X,i);f&&f.props&&(f.props.onDestroy=()=>{setTimeout(()=>{n.render(null,o)},300)}),n.render(f,o),o.firstElementChild&&document.body.appendChild(o.firstElementChild)}});
